# A2_Extreme-Programming
# 通讯录管理系统 - 新功能说明

## 功能更新概览

本次更新为通讯录管理系统添加了三大核心功能：

### 1. 联系人收藏功能 

**功能描述：**
- 允许用户将重要联系人标记为收藏
- 收藏的联系人会在列表中优先显示
- 提供收藏筛选功能，可以只查看收藏的联系人

**使用方法：**
1. 在联系人卡片上点击星形图标即可收藏/取消收藏
2. 点击工具栏的"收藏"按钮可以筛选只显示收藏的联系人
3. 收藏的联系人卡片会有黄色边框和浅黄色背景

**技术实现：**
- 数据库添加 `is_favorite` 字段
- 列表查询时优先显示收藏联系人
- 提供独立的收藏切换API

---

### 2. 多种联系方式管理 

**功能描述：**
- 支持为单个联系人添加多种联系方式
- 支持的联系方式类型：
  - 电话号码
  - 电子邮箱
  - 微信账号
  - QQ账号
  - 微博账号
  - 实际居住地址
- 每种联系方式可以添加标签（如：工作、家庭、其他）

**使用方法：**
1. 在新增/编辑联系人时，找到"额外联系方式"区域
2. 点击"添加联系方式"按钮
3. 选择联系方式类型，输入值和标签（可选）
4. 可以添加多个联系方式
5. 点击红色删除按钮可以移除不需要的联系方式

**技术实现：**
- 创建 `contact_methods` 表存储额外联系方式
- 使用外键关联到主联系人表
- 提供独立的联系方式管理API

---

### 3. 导入与导出功能 

**功能描述：**
- **导出功能**：将所有联系人信息导出为CSV格式文件（Excel可直接打开）
- **导入功能**：从CSV文件批量导入联系人

**导出功能使用方法：**
1. 点击工具栏的"导出"按钮
2. 系统会自动生成CSV文件并下载
3. 文件名格式：`contacts_YYYYMMDDHHMMSS.csv`
4. 导出内容包括：ID、姓名、主电话、主邮箱、地址、备注、是否收藏、创建时间、更新时间

**导入功能使用方法：**
1. 准备CSV文件，格式要求：
   - 第一行为表头：ID, 姓名, 主电话, 主邮箱, 地址, 备注, 是否收藏
   - 从第二行开始为数据
   - 姓名和电话为必填项
   - 是否收藏填写"是"或"否"
2. 点击工具栏的"导入"按钮
3. 选择CSV文件
4. 点击"开始导入"
5. 系统会显示导入结果（成功数量、失败数量、错误详情）

**CSV文件格式示例：**
```csv
ID,姓名,主电话,主邮箱,地址,备注,是否收藏
1,高子言,15060681339,3100484088@qq.com,福建省福州市,Family,是
```

**注意事项：**
- 导入时会检查电话号码格式（必须是11位手机号）
- 重复的电话号码会被跳过
- 建议先导出现有数据作为模板，再进行编辑和导入

**技术实现：**
- 导出：后端生成CSV文件，前端通过base64下载
- 导入：前端读取文件，后端解析并批量插入数据
- 支持UTF-8编码，正确显示中文

---

## 数据库变更

### 1. contacts 表新增字段
```sql
`is_favorite` TINYINT(1) DEFAULT 0 COMMENT '是否收藏(0:否,1:是)'
```

### 2. 新增 contact_methods 表
```sql
CREATE TABLE `contact_methods` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `contact_id` INT(11) NOT NULL COMMENT '联系人ID',
  `method_type` VARCHAR(20) NOT NULL COMMENT '联系方式类型',
  `method_value` VARCHAR(255) NOT NULL COMMENT '联系方式值',
  `label` VARCHAR(50) DEFAULT NULL COMMENT '标签',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  FOREIGN KEY (`contact_id`) REFERENCES `contacts`(`id`) ON DELETE CASCADE
);
```

---

## 新增API接口

### 1. 收藏功能
- **路径**: `/backend/api/favorite.php`
- **方法**: POST
- **参数**: `{ "id": 联系人ID }`
- **功能**: 切换联系人的收藏状态

### 2. 联系方式管理
- **路径**: `/backend/api/contact_methods.php`
- **方法**: GET, POST, DELETE
- **功能**: 
  - GET: 获取联系人的所有联系方式
  - POST: 添加新的联系方式
  - DELETE: 删除联系方式

### 3. 导出通讯录
- **路径**: `/backend/api/export.php`
- **方法**: GET
- **功能**: 导出所有联系人为CSV文件

### 4. 导入通讯录
- **路径**: `/backend/api/import.php`
- **方法**: POST
- **参数**: `{ "content": "base64编码的文件内容" }`
- **功能**: 从CSV文件导入联系人

---

## 安装和使用

### 1. 更新数据库
执行 `init.sql` 文件以创建新的数据库表和字段：
```bash
mysql -u root -p < init.sql
```

### 2. 配置后端
确保 `backend/config/database.php` 中的数据库配置正确。

### 3. 启动服务
使用PHP内置服务器或其他Web服务器启动应用。

### 4. 访问应用
打开浏览器访问前端页面，即可使用所有新功能。

---

## 技术栈

- **前端**: HTML5, CSS3, JavaScript (原生)
- **后端**: PHP 7.4+
- **数据库**: MySQL 5.7+
- **架构**: 前后端分离, RESTful API

---

## 功能特点

✅ 联系人收藏标记和筛选  
✅ 多种联系方式管理（电话、邮箱、社交媒体等）  
✅ 批量导入导出（CSV/Excel格式）  
✅ 响应式设计，支持移动端  
✅ 美观的UI界面  
✅ 完善的错误处理  
✅ 数据验证和安全防护  

---

## 注意事项

1. **数据库备份**: 在执行数据库更新前，请先备份现有数据
2. **文件编码**: 导入的CSV文件必须使用UTF-8编码
3. **电话格式**: 电话号码必须是11位的中国大陆手机号（1开头）
4. **浏览器兼容**: 建议使用现代浏览器（Chrome, Firefox, Safari, Edge）

---

## 更新日期

2025年12月12日
